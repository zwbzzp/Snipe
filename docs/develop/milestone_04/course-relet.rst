课程延时功能说明
===========================

概述
---------------------------
当老师拖堂，想延迟课程对应当天课时的虚拟桌面回收时间时，可以使用课程延时功能，延迟该堂课全部虚拟桌面的回收时间

前置条件
---------------------------
当前课程正在上课，该课程后续没有课时，不与当前课时延时后存在冲突。

为防止与调度冲突，应该在课时结束前 2-5 分钟前进行课程延时操作


页面流程
---------------------------
1. 用户点击需要续租课程的延时按钮，课程延时操作必须在该课程对应的课时结束2分钟前使用

2. 弹出对话框，要求用户输入延时时间长度，以分钟为单位，例如输入数字15，则延时课程15分钟，按确认按钮

3. 系统检查延时时间，并与本课程其它课时进行比较，假如存在冲突，则返回错误信息，否则提示操作成功


核心实现逻辑
---------------------------
课程延时实质上就是把现时课程里所有虚拟桌面的回收时间延后。实现上只要把课程里所有的虚拟桌面回收时间延后用户指定的时间长度。

为每个课程相关的虚拟桌面建立如下桌面任务：

DesktopTask
    action： DELAY
    state： 'PENDING'
    stage_chain： json.dumps(['DELAY'])
    stage： 'DELAY'
    context： {
        'desktop': desktop.id,
        'latency': 900,
        'original_end_datetime': desktop.end_datetime.isoformat()
    }


备注
---------------------------
尝试使用 DesktopTask 作为虚拟桌面操作的唯一接口，优点如下：

1. 异步，能够提高系统性能并且对于用户来说有即时反馈

2. 任务跟踪，任务框架对每个任务和任务的每个阶段都有跟踪记录，方便跟踪任务错误信息，并且可以实现任务重做和重置

3. 统一桌面操作接口，易于维护

